<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Mata Kuliah Academic Years Page -->
    <template id="mata_kuliah_academic_years" name="Tahun Akademik Mata Kuliah">
        <t t-call="website.layout">
            <div id="wrap">
                <!-- Page Header -->
                <section class="bg-light py-5">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8">
                                <h1 class="display-4 fw-bold">Mata Kuliah</h1>
                                <p class="lead">Pilih tahun akademik untuk melihat daftar mata kuliah yang pernah dihandle</p>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Ringkasan</h5>
                                        <div class="row text-center">
                                            <div class="col-6">
                                                <h4 class="text-primary"><t t-esc="len(academic_years)"/></h4>
                                                <small class="text-muted">Tahun Akademik</small>
                                            </div>
                                            <div class="col-6">
                                                <h4 class="text-success">
                                                    <t t-esc="sum(year.course_count for year in academic_years)"/>
                                                </h4>
                                                <small class="text-muted">Total Mata Kuliah</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Academic Years Grid -->
                <section class="py-5">
                    <div class="container">
                        <div class="row">
                            <t t-foreach="academic_years" t-as="year">
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="card h-100 shadow-sm">
                                        <div class="card-header bg-primary text-white">
                                            <h4 class="card-title mb-0">
                                                <a t-att-href="'/mata-kuliah/tahun/' + str(year.id)" 
                                                   class="text-white text-decoration-none">
                                                    <t t-esc="year.name"/>
                                                </a>
                                            </h4>
                                        </div>
                                        <div class="card-body">
                                            <div class="row text-center">
                                                <div class="col-12">
                                                    <h3 class="text-primary"><t t-esc="year.course_count"/></h3>
                                                    <small class="text-muted">Mata Kuliah</small>
                                                </div>
                                            </div>
                                            
                                            <!-- Semester breakdown - will be added later -->
                                        </div>
                                        <div class="card-footer">
                                            <a t-att-href="'/mata-kuliah/tahun/' + str(year.id)" 
                                               class="btn btn-primary btn-sm w-100">
                                                Lihat Mata Kuliah
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                        
                        <t t-if="not academic_years">
                            <div class="text-center py-5">
                                <i class="fa fa-calendar fa-3x text-muted mb-3"/>
                                <h3 class="text-muted">Belum ada tahun akademik</h3>
                                <p class="text-muted">Tahun akademik akan muncul setelah ditambahkan di backend</p>
                            </div>
                        </t>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- Mata Kuliah Index Page -->
    <template id="mata_kuliah_index" name="Daftar Mata Kuliah">
        <t t-call="website.layout">
            <div id="wrap">
                <!-- Page Header -->
                <section class="bg-light py-4">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8">
                                <h1 class="display-5 fw-bold">Mata Kuliah</h1>
                                <p class="lead">
                                    Tahun Akademik: <strong><t t-esc="academic_year.name"/></strong>
                                    <small class="text-muted ms-2">
                                        (<a href="/mata-kuliah" class="text-decoration-none">Ganti Tahun</a>)
                                    </small>
                                </p>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Statistik <t t-esc="academic_year.name"/></h5>
                                        <div class="row text-center">
                                            <div class="col-6">
                                                <h4 class="text-primary"><t t-esc="stats['total_courses']"/></h4>
                                                <small class="text-muted">Total Mata Kuliah</small>
                                            </div>
                                            <div class="col-6">
                                                <h4 class="text-success"><t t-esc="stats['active_courses']"/></h4>
                                                <small class="text-muted">Masih Diajar</small>
                                            </div>
                                        </div>
                                        <div class="row text-center mt-2">
                                            <div class="col-6">
                                                <h5 class="text-info"><t t-esc="stats['mandatory_courses']"/></h5>
                                                <small class="text-muted">Wajib</small>
                                            </div>
                                            <div class="col-6">
                                                <h5 class="text-warning"><t t-esc="stats['total_sks']"/></h5>
                                                <small class="text-muted">Total SKS</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Search and Filters -->
                <section class="py-4 border-bottom">
                    <div class="container">
                        <form method="get" class="row g-3">
                            <div class="col-md-3">
                                <input type="text" class="form-control" name="search"
                                       placeholder="Cari nama mata kuliah, kode, atau deskripsi..."
                                       t-att-value="search"/>
                            </div>
                            <div class="col-md-2">
                                <select name="category_id" class="form-select">
                                    <option value="">Semua Kategori</option>
                                    <t t-foreach="categories" t-as="category">
                                        <option t-att-value="category.id"
                                                t-att-selected="category_id == category.id">
                                            <t t-esc="category.name"/>
                                        </option>
                                    </t>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select name="semester" class="form-select">
                                    <option value="">Semua Semester</option>
                                    <option value="1" t-att-selected="semester == '1'">Semester 1</option>
                                    <option value="2" t-att-selected="semester == '2'">Semester 2</option>
                                    <option value="3" t-att-selected="semester == '3'">Semester 3</option>
                                    <option value="4" t-att-selected="semester == '4'">Semester 4</option>
                                    <option value="5" t-att-selected="semester == '5'">Semester 5</option>
                                    <option value="6" t-att-selected="semester == '6'">Semester 6</option>
                                    <option value="7" t-att-selected="semester == '7'">Semester 7</option>
                                    <option value="8" t-att-selected="semester == '8'">Semester 8</option>
                                    <option value="odd" t-att-selected="semester == 'odd'">Ganjil</option>
                                    <option value="even" t-att-selected="semester == 'even'">Genap</option>
                                    <option value="both" t-att-selected="semester == 'both'">Ganjil &amp; Genap</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select name="course_type" class="form-select">
                                    <option value="">Semua Tipe</option>
                                    <option value="mandatory" t-att-selected="course_type == 'mandatory'">Wajib</option>
                                    <option value="elective" t-att-selected="course_type == 'elective'">Pilihan</option>
                                    <option value="specialization" t-att-selected="course_type == 'specialization'">Keahlian</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <select name="sks" class="form-select">
                                    <option value="">Semua SKS</option>
                                    <t t-foreach="sks_options" t-as="sks_val">
                                        <option t-att-value="sks_val" t-att-selected="sks == sks_val">
                                            <t t-esc="sks_val"/> SKS
                                        </option>
                                    </t>
                                </select>
                            </div>
                            <div class="col-md-1">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fa fa-search"/>
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Results -->
                <section class="py-5">
                    <div class="container">
                        <t t-if="not posts">
                            <div class="text-center py-5">
                                <i class="fa fa-search fa-3x text-muted mb-3"/>
                                <h3 class="text-muted">Tidak ada mata kuliah ditemukan</h3>
                                <p class="text-muted">Coba ubah kriteria pencarian Anda</p>
                            </div>
                        </t>

                        <t t-else="">
                            <div class="row">
                                <t t-foreach="posts" t-as="post">
                                    <div class="col-lg-6 col-xl-4 mb-4">
                                        <div class="card h-100 shadow-sm">
                                            <div class="card-header bg-light">
                                                <small class="text-muted">
                                                    <strong><t t-esc="post.course_code"/></strong> •
                                                    <t t-esc="post.sks"/> SKS •
                                                    Semester <t t-esc="post.semester"/>
                                                </small>
                                            </div>
                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    <a t-att-href="post.website_url" class="text-decoration-none text-dark">
                                                        <t t-esc="post.name"/>
                                                    </a>
                                                </h5>
                                                <p class="card-text">
                                                    <strong>Tipe:</strong>
                                                    <span class="badge bg-primary me-1">
                                                        <t t-if="post.course_type == 'mandatory'">Wajib</t>
                                                        <t t-elif="post.course_type == 'elective'">Pilihan</t>
                                                        <t t-else="">Keahlian</t>
                                                    </span>
                                                </p>

                                                <!-- Teaser/Preview -->
                                                <p class="card-text text-muted small" t-if="post.teaser">
                                                    <t t-esc="post.teaser"/>
                                                </p>

                                                <!-- Rating -->
                                                <div class="small text-muted" t-if="post.course_rating > 0">
                                                    <i class="fa fa-star text-warning"/>
                                                    <t t-esc="'%.1f' % post.course_rating"/>/5.0
                                                    (<t t-esc="post.typical_students"/> mahasiswa rata-rata)
                                                </div>
                                            </div>
                                            <div class="card-footer bg-transparent">
                                                <small class="text-muted">
                                                    <i class="fa fa-folder-o"/> <t t-esc="post.blog_id.name"/>
                                                    <t t-if="post.academic_year_ids">
                                                        • <i class="fa fa-graduation-cap"/>
                                                        <t t-foreach="post.academic_year_ids" t-as="year">
                                                            <t t-esc="year.name"/><t t-if="not year_last">, </t>
                                                        </t>
                                                    </t>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>

                            <!-- Pagination -->
                            <div class="d-flex justify-content-center mt-4">
                                <t t-call="website.pager"/>
                            </div>
                        </t>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <!-- Mata Kuliah Post Detail Page -->
    <template id="mata_kuliah_post_detail" name="Detail Mata Kuliah">
        <t t-call="website.layout">
            <!-- Set website title and meta -->
            <t t-set="title" t-value="post.get_meta_title()"/>
            <t t-set="website_meta_title" t-value="post.get_meta_title()"/>
            <t t-set="website_meta_description" t-value="post.get_meta_description()"/>
            <t t-set="website_meta_keywords" t-value="post.get_meta_keywords()"/>

            <!-- Custom head content -->
            <t t-set="head">
                <t t-raw="0"/>
                <!-- SEO Meta Tags -->
                <meta name="description" t-att-content="post.get_meta_description()"/>
                <meta name="keywords" t-att-content="post.get_meta_keywords()"/>

                <!-- Open Graph Tags -->
                <meta property="og:title" t-att-content="post.get_meta_title()"/>
                <meta property="og:description" t-att-content="post.get_meta_description()"/>
                <meta property="og:type" content="article"/>
                <meta property="og:url" t-att-content="request.httprequest.url"/>
            </t>

            <div id="wrap" class="oe_structure my-4 py-4">
                <div class="container mt-4">
                    <div class="row">
                        <div class="col-lg-8">
                            <!-- Course Header -->
                            <div class="mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <h1 t-field="post.name"/>
                                    <span class="badge bg-primary ms-3 fs-6">
                                        <t t-esc="post.course_code"/>
                                    </span>
                                </div>
                                <h4 class="text-muted" t-field="post.subtitle" t-if="post.subtitle"/>

                                <div class="row mt-3">
                                    <div class="col-md-6">
                                        <p><strong>Kode Mata Kuliah:</strong> <span t-field="post.course_code"/></p>
                                        <p><strong>Semester:</strong> <span t-field="post.semester"/></p>
                                        <p><strong>SKS:</strong> <span t-field="post.sks"/></p>
                                        <p><strong>Tipe:</strong>
                                            <span class="badge bg-primary">
                                                <t t-if="post.course_type == 'mandatory'">Wajib</t>
                                                <t t-elif="post.course_type == 'elective'">Pilihan</t>
                                                <t t-else="">Keahlian</t>
                                            </span>
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Tahun Akademik:</strong>
                                            <t t-foreach="post.academic_year_ids" t-as="year">
                                                <span class="badge bg-info me-1"><t t-esc="year.name"/></span>
                                            </t>
                                        </p>
                                        <p t-if="post.typical_students"><strong>Jumlah Mahasiswa:</strong> <span t-field="post.typical_students"/> (rata-rata)</p>
                                        <p t-if="post.course_rating > 0">
                                            <strong>Rating:</strong>
                                            <span class="text-warning">
                                                <t t-foreach="range(int(post.course_rating))" t-as="star">
                                                    ★
                                                </t>
                                            </span>
                                            <t t-esc="'%.1f' % post.course_rating"/>/5.0
                                        </p>
                                    </div>
                                </div>

                                <!-- Prerequisites -->
                                <div class="mt-3" t-if="post.prerequisites">
                                    <h5>Prasyarat</h5>
                                    <p t-field="post.prerequisites"/>
                                </div>
                            </div>

                            <!-- Course Content -->
                            <div class="mb-4">
                                <h3>Deskripsi Mata Kuliah</h3>
                                <div t-field="post.content" class="oe_structure"/>
                            </div>

                            <!-- Learning Objectives -->
                            <div class="row mb-4" t-if="post.learning_objectives">
                                <div class="col-12">
                                    <h5>Capaian Pembelajaran</h5>
                                    <div t-field="post.learning_objectives"/>
                                </div>
                            </div>

                            <!-- Assessment Methods -->
                            <div class="row mb-4" t-if="post.assessment_methods">
                                <div class="col-12">
                                    <h5>Metode Penilaian</h5>
                                    <div t-field="post.assessment_methods"/>
                                </div>
                            </div>

                            <!-- Materials -->
                            <div class="row mb-4" t-if="post.textbook_ids or post.resource_ids">
                                <div class="col-md-6" t-if="post.textbook_ids">
                                    <h5>Buku Referensi</h5>
                                    <ul class="list-unstyled">
                                        <t t-foreach="post.textbook_ids.sorted(key=lambda x: x.sequence)" t-as="book">
                                            <li class="mb-2">
                                                <strong><t t-esc="book.name"/></strong>
                                                <t t-if="book.author"><br/><small class="text-muted">Penulis: <t t-esc="book.author"/></small></t>
                                                <t t-if="book.publisher or book.year">
                                                    <br/><small class="text-muted">
                                                        <t t-if="book.publisher"><t t-esc="book.publisher"/></t>
                                                        <t t-if="book.publisher and book.year">, </t>
                                                        <t t-if="book.year"><t t-esc="book.year"/></t>
                                                    </small>
                                                </t>
                                                <t t-if="book.isbn"><br/><small class="text-muted">ISBN: <t t-esc="book.isbn"/></small></t>
                                            </li>
                                        </t>
                                    </ul>
                                </div>
                                <div class="col-md-6" t-if="post.resource_ids">
                                    <h5>Sumber Belajar Tambahan</h5>
                                    <ul class="list-unstyled">
                                        <t t-foreach="post.resource_ids.sorted(key=lambda x: x.sequence)" t-as="resource">
                                            <li class="mb-2">
                                                <t t-if="resource.url">
                                                    <a t-att-href="resource.url" target="_blank" rel="noopener noreferrer" class="text-decoration-none">
                                                        <strong><t t-esc="resource.name"/></strong>
                                                        <i class="fa fa-external-link ms-1 small"></i>
                                                    </a>
                                                </t>
                                                <t t-else="">
                                                    <strong><t t-esc="resource.name"/></strong>
                                                </t>
                                                <t t-if="resource.resource_type">
                                                    <br/><small class="text-muted">
                                                        <t t-if="resource.resource_type == 'website'">Website</t>
                                                        <t t-elif="resource.resource_type == 'video'">Video</t>
                                                        <t t-elif="resource.resource_type == 'document'">Dokumen</t>
                                                        <t t-elif="resource.resource_type == 'software'">Software</t>
                                                        <t t-else="">Lainnya</t>
                                                    </small>
                                                </t>
                                                <t t-if="resource.description">
                                                    <br/><small class="text-muted"><t t-esc="resource.description"/></small>
                                                </t>
                                            </li>
                                        </t>
                                    </ul>
                                </div>
                            </div>

                            <!-- Syllabus Summary -->
                            <div class="mb-4" t-if="post.syllabus_summary">
                                <h5>Ringkasan Silabus</h5>
                                <div t-field="post.syllabus_summary"/>
                            </div>

                        </div>

                        <!-- Sidebar -->
                        <div class="col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Informasi Tambahan</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Kategori:</strong> <span t-field="post.blog_id.name"/></p>
                                    <p t-if="post.max_students"><strong>Kapasitas Maksimal:</strong> <span t-field="post.max_students"/> mahasiswa</p>
                                    <p t-if="post.student_satisfaction > 0">
                                        <strong>Kepuasan Mahasiswa:</strong> <t t-esc="'%.1f' % post.student_satisfaction"/>/5.0
                                    </p>
                                    <div class="small text-muted mt-3">
                                        <p>Dibuat: <span t-field="post.create_date" t-options="{'widget': 'datetime'}"/></p>
                                        <p>Terakhir diubah: <span t-field="post.write_date" t-options="{'widget': 'datetime'}"/></p>
                                    </div>
                                </div>
                            </div>

                            <!-- Related Courses -->
                            <div class="card mt-4" t-if="related_posts">
                                <div class="card-header">
                                    <h5>Mata Kuliah Terkait</h5>
                                </div>
                                <div class="card-body">
                                    <t t-foreach="related_posts" t-as="related">
                                        <div class="mb-3">
                                            <a t-att-href="related.website_url" class="text-decoration-none">
                                                <h6 t-esc="related.name"/>
                                            </a>
                                            <small class="text-muted d-block">
                                                <t t-esc="related.course_code"/> •
                                                <t t-esc="related.sks"/> SKS •
                                                Semester <t t-esc="related.semester"/>
                                            </small>
                                        </div>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Category Page -->
    <template id="mata_kuliah_category" name="Kategori Mata Kuliah">
        <t t-call="website.layout">
            <div id="wrap" class="oe_structure my-4 py-4">
                <div class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h1 t-field="category.name"/>
                            <p class="text-muted" t-field="category.subtitle"/>
                            <p class="text-info">
                                <strong>Tingkat:</strong>
                                <t t-if="category.course_level == 'undergraduate'">Sarjana</t>
                                <t t-elif="category.course_level == 'graduate'">Magister</t>
                                <t t-elif="category.course_level == 'doctoral'">Doktor</t>
                                <t t-else="">Semua Tingkat</t>
                                <t t-if="category.faculty"> • <strong>Fakultas:</strong> <span t-field="category.faculty"/></t>
                            </p>

                            <div class="row">
                                <t t-foreach="posts" t-as="post">
                                    <div class="col-lg-6 col-xl-4 mb-4">
                                        <div class="card h-100">
                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    <a t-att-href="post.website_url">
                                                        <t t-esc="post.name"/>
                                                    </a>
                                                </h5>
                                                <p><strong>Kode:</strong> <span t-field="post.course_code"/></p>
                                                <p><strong>SKS:</strong> <span t-field="post.sks"/></p>
                                                <small class="text-muted">
                                                    Semester <t t-esc="post.semester"/>
                                                </small>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>

                            <t t-call="website.pager"/>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>